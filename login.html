<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Connexion - AMT Gestion</title>
    <link rel="stylesheet" href="style.css">
    <link rel="icon" type="image/png" href="logo.png">
    <style>
        .login-box { max-width: 400px; margin: 100px auto; padding: 30px; background: white; border-radius: 12px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); text-align: center; }
        .login-box input { width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #ddd; border-radius: 8px; }
    </style>
</head>
<body style="background: #f0f2f5; font-family: 'Comfortaa', sans-serif;">
    <div class="login-box">
        <img src="logo.png" alt="Logo" style="width: 80px; margin-bottom: 20px;">
        <h2 style="color: #1877f2;">AMT Transit</h2>
        <p style="font-size: 14px; color: #666;">Connectez-vous pour continuer</p>
        
        <input type="text" id="username" placeholder="Nom d'utilisateur (ex: Abdoul)">
        <input type="password" id="password" placeholder="Mot de passe">
        
        <button id="btnLogin" class="primary" style="width: 100%; background: #1877f2; border: none; padding: 12px; color: white; border-radius: 8px; cursor: pointer; font-weight: bold; margin-top: 10px;">
            Se connecter
        </button>
        <p id="loginError" style="color: red; font-size: 12px; margin-top: 10px;"></p>
    </div>

    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

<script>
    // 1. Définition de la configuration (L'élément qui manquait)
    const firebaseConfig = {
        apiKey: "AIzaSyCV8hR9MxIdpZDthtQpMbByZtNet1nIO-M",
        authDomain: "app-ventes-barriques.firebaseapp.com",
        projectId: "app-ventes-barriques",
        storageBucket: "app-ventes-barriques.appspot.com",
        messagingSenderId: "615546459847",
        appId: "1:615546459847:web:1b387b0b703b7a9a1210e2"
    };

    // 2. Initialisation
    if (!firebase.apps.length) {
        firebase.initializeApp(firebaseConfig);
    }
    const auth = firebase.auth();

    // 3. Logique de connexion
    document.getElementById('btnLogin').addEventListener('click', () => {
        const usernameInput = document.getElementById('username').value.trim();
        const pass = document.getElementById('password').value;
        const errorEl = document.getElementById('loginError');

        if (!usernameInput || !pass) {
            errorEl.innerText = "Veuillez remplir tous les champs.";
            return;
        }

        // Nettoyage du nom pour l'email
        const cleanedUser = usernameInput.toLowerCase()
            .normalize("NFD").replace(/[\u0300-\u036f]/g, "")
            .replace(/\s+/g, '');

        const email = cleanedUser + "@amt.com";

        auth.signInWithEmailAndPassword(email, pass)
            .then((userCredential) => {
                const urlParams = new URLSearchParams(window.location.search);
                const redirect = urlParams.get('redirect') || 'recuperation.html';
                window.location.href = redirect;
            })
            .catch((error) => {
                console.error(error);
                errorEl.innerText = "Utilisateur ou mot de passe incorrect.";
            });
    });
</script>
</body>
</html>